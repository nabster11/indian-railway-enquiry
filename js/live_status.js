$(document).on("pageshow","#live_status",function(j,f){j.stopImmediatePropagation();j.preventDefault();var a=new Date().toString();var b=a.substr(8,2)+"-"+a.substr(4,3).toUpperCase()+"-"+a.substr(11,4);var c=[];c=localStorage.tdata.split(",");var d=parseInt(localStorage.cno)+1;function h(m){var e=JSON.parse(m);$("s_list").html("");$("#output1").html("");$("#live_output").html("");if(e.status=="OK"){if(e.result.route.stn=="[]"){$("#output1").html("The server didn't returned any list of stations , the request may succced if you try again or if have tried many times try to report this as a bug");}else{var l='<div if ="s_list" class="ui-field-contain"><label for="station_list">Select Station</label><select id="station_list">';$.each(e.result.route[0].stn,function(o,n){l+="<option value="+n.code+">"+n.name+"</option>";});l+="</select></div>";l+='<p><a href="#" id="live_s" data-role="button" data-theme="e">Get Live Status</a></p>';$("#lu").html("The Live Status of the <span class ='trainn'>"+e.result.name);$(l).appendTo("#output1").trigger("create");$("#todaydate").val(b);}}else{$("#output1").html("The request could not be processed due to a server error,it may succeed if you try again");}}function i(e){}$.ajax({type:"GET",url:"http://api.erail.in/route/?key=YOUR_API_KEY&trainno="+c[d],cache:false,beforeSend:function(){$.mobile.loading("show",{theme:"b",text:"Please wait...",textonly:false,textVisible:true});},success:h,error:i,complete:function(){$.mobile.loading("hide");}});function k(e){var m=JSON.parse(e);if(m.status=="OK"){$("#live_output").html("");$.each(m.result,function(o,n){if(n==null){n=" ";}});var l="";if(m.result.depflag==0&&m.result.arrflag==0){l+='<p style="color: brown;">The Train is yet to arrive at this station</p>';}else{if(m.result.arrflag==1&&m.result.depflag==0){l+='<p style="color: brown;">The Train has arrived at this station</p>';}else{l+='<p style="color: brown;">The Train has departed from this station</p>';}}l+='<table id ="live_table" data-role="table" data-mode="reflow" class="ui-responsive table-stroke table-stripe ui-shadow"><tr><th> Status at </th><td>'+m.result.statusat+"</td></tr><tr><th> Delayed by </th><td>"+m.result.delayrun+"</td></tr><tr><th> Status msg </th><td>"+m.result.statusmsg+"</td></tr><tr><th> Actual arr </th><td>"+m.result.actarr+"</td></tr><tr><th> Actual dep </th><td>"+m.result.actdep+"</td></tr><tr><th> Schedule arr </th><td>"+m.result.scharr+"</td></tr><tr><th> Schedule dep </th><td>"+m.result.schdep+"</td></tr><tr><th> Delay arr </th><td>"+m.result.delaydep+"</td></tr><tr><th> Delay arr </th><td>"+m.result.delayarr+"</td></tr><tr><th> Distance to go </th><td>"+m.result.disttogo+" KM</td></tr></table>";$(l).appendTo("#live_output").trigger("create");}else{$("#output1").html("The request could not be processed due to a server error,it may succeed if you try again");}}function g(e){}$(document).off("vclick","#live_s").on("vclick","#live_s",function(l){$.ajax({type:"GET",url:"http://api.erail.in/live/?key=YOUR_API_KEY&trainno="+c[d]+"&stnfrom="+$("#station_list").val()+"&date="+b,cache:false,beforeSend:function(){$.mobile.loading("show",{theme:"b",text:"Please wait...",textonly:false,textVisible:true});},success:k,error:g,complete:function(){$.mobile.loading("hide");}});});});
